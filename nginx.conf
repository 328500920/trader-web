#user  nobody;
worker_processes  1;

#error_log  logs/error.log;
#error_log  logs/error.log  notice;
#error_log  logs/error.log  info;

#pid        logs/nginx.pid;


events {
    worker_connections  1024;
}


http {
    include       mime.types;
    default_type  application/octet-stream;

    sendfile        on;
    #tcp_nopush     on;

    #keepalive_timeout  0;
    keepalive_timeout  65;

    #gzip  on;

    upstream yudaoServer{
        server 139.159.244.82:56080;
    }

   

        server {
                listen 56070;
                server_name localhost;
                return 301 https://$host$request_uri;
        }

    # HTTPS server    
    server {
        listen 56071 ssl;
        server_name  superstart.net.cn;
        
        ssl_certificate      /home/subt/admission/nginx_admission/ssl/scs1733792260458_www.superstart.net.cn_server.crt;
        ssl_certificate_key  /home/subt/admission/nginx_admission/ssl/scs1733792260458_www.superstart.net.cn_server.key;
                ssl_session_timeout 5m;
                ssl_protocols        TLSv1.2 TLSv1.3;
                ssl_ciphers          HIGH:!aNULL:!MD5;
                ssl_prefer_server_ciphers on;
                
                charset        UTF-8;
        
                server_tokens off;#隐藏版本号
        
        location / {
                                root   /home/subt/admission/nginx_admission/dist-prod;
        #        root   /home/subt/admission/nginx_admission/dist_simple;
                try_files $uri $uri/ /index.html;
                index  index.html index.htm;
        }
        
        location /prod-api/{     #vue访问后端接口地址
                  proxy_set_header Host $http_host;
                  proxy_set_header X-Real-IP $remote_addr;
                  proxy_set_header REMOTE-HOST $remote_addr;
                  proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                  proxy_pass http://yudaoServer;
        }               
                 
                error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   html;
        }
    }
        
        server {
                listen 60001;
                server_name your-domain.com;
                
                # 大文件上传支持
                client_max_body_size 1024M;

                # 前端静态资源
                location / {
                        root /home/subt/trader/trader_web/trader_dist;
                        try_files $uri $uri/ /index.html;
                        index index.html;
                }

                # API代理
                location /api {
                        proxy_pass http://127.0.0.1:60002;
                        proxy_set_header Host $host;
                        proxy_set_header X-Real-IP $remote_addr;
                        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                        proxy_set_header X-Forwarded-Proto $scheme;
                        
                        # 大文件上传超时配置
                        proxy_connect_timeout 600s;
                        proxy_send_timeout 600s;
                        proxy_read_timeout 600s;
                        
                        # 关闭代理缓冲，避免大文件上传问题
                        proxy_request_buffering off;
                }

                # 上传文件
                location /uploads {
                        alias /home/subt/trader/uploads;
                        expires 7d;
                }

                # 静态资源缓存
                location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2)$ {
                        root /home/subt/trader/trader_web/trader_dist;
                        expires 30d;
                }
        }

}
